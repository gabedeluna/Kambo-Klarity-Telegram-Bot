<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.ngrok.com https://assets.ngrok.com 'unsafe-eval' 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com https://assets.ngrok.com https://cdn.ngrok.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.tailwindcss.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://telegram.org https://cdn.tailwindcss.com; img-src 'self' data: https:; media-src 'self' data: https:; connect-src 'self' https: wss:;">
    <title>Book Kambo Session</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Manrope%3Awght%40400%3B500%3B700%3B800&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <style>
      body {
        background: 
          url('background-for-calendar.png') center/cover no-repeat fixed,
          linear-gradient(135deg, #1a4d2e 0%, #2d5016 30%, #1a3d0f 70%, #0f2408 100%);
        min-height: 100vh;
        position: relative;
        overflow: hidden;
      }
      
      /* Video background styling */
      .video-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -2;
      }
      
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.1);
        z-index: -1;
      }
      
      .calendar-container {
        background: rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
      }
      
      .time-scroll-container {
        -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 25%, black 75%, transparent 100%);
        mask-image: linear-gradient(to bottom, transparent 0%, black 25%, black 75%, transparent 100%);
      }
      
      /* Hide scrollbar for a cleaner look */
      #timeSlotList::-webkit-scrollbar {
        display: none;
      }
      #timeSlotList {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      /* Calendar day styling */
      .calendar-day {
        transition: all 0.3s ease;
        background: transparent;
        border: none;
        color: rgba(245, 245, 220, 0.3);
        font-weight: 500;
      }
      
      .calendar-day.available {
        color: #faf0e6;
        font-weight: 600;
      }
      
      .calendar-day.available:hover {
        background: rgba(83, 210, 44, 0.2);
        color: #53d22c;
        transform: scale(1.1);
      }
      
      .calendar-day.selected {
        background: #53d22c !important;
        color: #162013 !important;
        font-weight: 700;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(83, 210, 44, 0.4);
      }
      
      /* Time slot styling */
      .time-slot-item {
        transition: all 0.3s ease;
        color: rgba(245, 245, 220, 0.8);
        font-weight: 600;
        font-size: 1.125rem;
      }
      
      .time-slot-item.selected {
        background-color: #53d22c !important;
        color: #162013 !important;
        border-radius: 12px;
        font-weight: 700;
        box-shadow: 0 4px 12px rgba(83, 210, 44, 0.4);
      }
      
      /* Button styling */
      .btn-primary {
        background: #53d22c;
        color: #162013;
        font-weight: 700;
        border-radius: 16px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(83, 210, 44, 0.3);
      }
      
      .btn-primary:not(:disabled) {
        animation: pulseGreen 2s infinite;
      }
      
      @keyframes pulseGreen {
        0% {
          box-shadow: 0 4px 12px rgba(83, 210, 44, 0.3);
        }
        50% {
          box-shadow: 0 4px 20px rgba(83, 210, 44, 0.6), 0 0 30px rgba(83, 210, 44, 0.4);
        }
        100% {
          box-shadow: 0 4px 12px rgba(83, 210, 44, 0.3);
        }
      }
      
      .btn-primary:hover {
        background: #45b525;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(83, 210, 44, 0.4);
      }
      
      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #fef7cd;
        font-weight: 600;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }
      
      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }
      
      .btn-secondary:active,
      .btn-secondary.pressed {
        background: rgba(220, 38, 38, 0.9) !important;
        color: white !important;
        border-color: rgba(220, 38, 38, 0.8) !important;
        transform: translateY(0) !important;
        box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4) !important;
      }
      
      /* Add specific class for when cancel button is in "pressed" state */
      .btn-secondary.cancel-pressed {
        background: rgba(220, 38, 38, 0.9) !important;
        color: white !important;
        border-color: rgba(220, 38, 38, 0.8) !important;
        transform: translateY(0) !important;
        box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4) !important;
      }
      
      /* Navigation buttons */
      .nav-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        transition: all 0.3s ease;
      }
      
      .nav-btn svg {
        fill: #faf0e6;
      }
      
      .nav-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
      }
      
      /* Loading state */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }
      
      /* Decorative elements - removed since we have background image */
      
      /* Force amber colors with higher specificity - FINAL OVERRIDE */
      #sessionTypeNamePlaceholder,
      h1#sessionTypeNamePlaceholder,
      .text-amber-50#sessionTypeNamePlaceholder {
        color: #fef7cd !important;
      }
      
      #sessionTypeDurationPlaceholder,
      p#sessionTypeDurationPlaceholder,
      .text-amber-50#sessionTypeDurationPlaceholder {
        color: #fef7cd !important;
      }
      
      #currentMonthYear,
      h2#currentMonthYear,
      .text-amber-50#currentMonthYear {
        color: #fef7cd !important;
      }
      
      /* Override any potential global styles */
      body * {
        color: inherit;
      }
      
      /* Ensure no other styles override our amber colors */
      .text-amber-50 {
        color: #fef7cd !important;
      }
    </style>
    <!-- Stagewise Development Toolbar (development only) -->
    <script type="module" src="stagewise-working.js"></script>
</head>
<body style='font-family: Manrope, "Noto Sans", sans-serif;' class="overflow-hidden">
    <!-- Video Background -->
    <video class="video-background" autoplay muted loop playsinline>
      <source src="background_video_with_frog.mov" type="video/quicktime">
      <source src="background_video_with_frog.webm" type="video/webm">
      <source src="background_video_with_frog.mp4" type="video/mp4">
      <!-- Fallback for browsers that don't support video -->
      Your browser does not support the video tag.
    </video>
    
    <div class="relative flex size-full min-h-screen flex-col justify-between">
      
      
      <!-- Main content wrapper -->
      <div class="flex-1 relative px-4 py-2 pt-6">
        
        <!-- Session Title - Fixed position -->
        <div class="text-center absolute top-16 left-0 right-0">
          <h1 class="text-amber-50 text-4xl font-bold mb-2" id="sessionTypeNamePlaceholder" style="color: #fef7cd !important;"></h1>
          <p class="text-amber-50 text-lg opacity-80" id="sessionTypeDurationPlaceholder" style="color: #fef7cd !important;"></p>
        </div>

        <!-- Calendar Container - Fixed position -->
        <div class="calendar-container w-full max-w-xs p-4 absolute top-48 left-1/2 transform -translate-x-1/2">
          
          <!-- Month Navigation -->
          <div class="flex items-center justify-between mb-4">
            <button id="prevMonthButton" class="nav-btn p-2" aria-label="Previous Month">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#faf0e6" viewBox="0 0 256 256">
                <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
              </svg>
            </button>
            
            <h2 id="currentMonthYear" class="text-amber-50 text-lg font-bold" style="color: #fef7cd !important;"></h2>
            
            <button id="nextMonthButton" class="nav-btn p-2" aria-label="Next Month">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#faf0e6" viewBox="0 0 256 256">
                <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
              </svg>
            </button>
          </div>

          <!-- Calendar Grid -->
          <div id="calendarGrid" class="grid grid-cols-7 gap-1">
            <!-- Day headers -->
            <div class="text-amber-100 text-xs font-bold text-center py-1">S</div>
            <div class="text-amber-100 text-xs font-bold text-center py-1">M</div>
            <div class="text-amber-100 text-xs font-bold text-center py-1">T</div>
            <div class="text-amber-100 text-xs font-bold text-center py-1">W</div>
            <div class="text-amber-100 text-xs font-bold text-center py-1">T</div>
            <div class="text-amber-100 text-xs font-bold text-center py-1">F</div>
            <div class="text-amber-100 text-xs font-bold text-center py-1">S</div>
            <!-- Calendar days will be dynamically inserted here -->
          </div>
        </div>

        <!-- Booking Info Area - Fixed position much further below calendar -->
        <div class="w-full px-4 absolute left-0 right-0" style="top: 520px;">
          <!-- Booking Summary -->
          <div class="booking-summary text-center mb-2" style="display: none;">
            <p id="selectedBookingInfo" class="text-amber-100 text-lg font-semibold"></p>
          </div>

          <!-- Message when no date selected -->
          <div id="selectDateMessage" class="text-center mb-2">
            <p class="text-amber-100 text-sm font-semibold opacity-80">Select an available day</p>
          </div>

          <!-- Time Scroller -->
          <div id="timePickerContainer" class="relative h-28 w-full max-w-xs mx-auto time-scroll-container mb-2" style="display: none;">
            <div id="selectorBar" class="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-8 bg-white bg-opacity-10 rounded-xl pointer-events-none z-0 transition-colors duration-300"></div>
            
            <div id="timeSlotList" class="absolute inset-0 overflow-y-auto snap-y snap-mandatory text-center py-10 z-10">
              <div class="snap-center h-8 flex items-center justify-center text-sm font-semibold text-amber-100 time-slot-item">Select a date first</div>
            </div>
          </div>
        </div>

      </div>

      <!-- Action Buttons -->
      <div class="fixed bottom-0 left-0 right-0 px-4" style="bottom: 35px;">
        <div class="flex gap-3 max-w-sm mx-auto">
          <button id="submitBookingButton" disabled class="btn-primary flex-1 h-12 text-base font-bold disabled:opacity-50 disabled:cursor-not-allowed">
            <span>Book</span>
          </button>
          <button id="cancelBookingButton" class="btn-secondary flex-1 h-12 text-sm font-semibold">
            <span>Cancel Booking</span>
          </button>
        </div>
      </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Disable the swipe-down gesture that collapses or closes the Mini App
        if (tg.isVersionAtLeast('7.7')) {
          tg.disableVerticalSwipes();
          console.log("Vertical swipes disabled for Telegram WebApp.");
        }
    </script>
    
    <!-- Calendar API Module -->
    <script src="calendar-api.js"></script>
    <!-- Calendar UI Module -->
    <script src="calendar-ui.js"></script>
    <!-- Calendar Data Module -->
    <script src="calendar-data.js"></script>
    <!-- Calendar App JavaScript -->
    <script src="calendar-app.js"></script>
</body>
</html>