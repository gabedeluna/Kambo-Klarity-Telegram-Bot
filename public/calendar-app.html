<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Book Kambo Session</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Manrope%3Awght%40400%3B500%3B700%3B800&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <style>
      .time-scroll-container {
        -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 25%, black 75%, transparent 100%);
        mask-image: linear-gradient(to bottom, transparent 0%, black 25%, black 75%, transparent 100%);
      }
      /* Hide scrollbar for a cleaner look */
      #timeSlotList::-webkit-scrollbar {
        display: none; /* Safari and Chrome */
      }
      #timeSlotList {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
      }
      /* Highlight the selected time slot with a gradient effect */
      .time-slot-item {
        transition: color 0.2s ease;
      }
      
      /* Time slot styling - removed auto-highlighting classes */
      .time-slot-item.selected {
        background-color: #53d22c !important;
        color: #162013 !important;
        border-radius: 8px;
      }
      
      /* Calendar day styling */
      .calendar-day {
        transition: all 0.2s ease;
      }
      .calendar-day.available {
        background-color: rgba(46, 67, 40, 0.6);
        border: 1px solid #2e4328;
      }
      .calendar-day.selected {
        background-color: #53d22c;
        color: #162013;
      }
      .calendar-day:hover {
        background-color: rgba(46, 67, 40, 0.3);
      }
      .calendar-day.selected:hover {
        background-color: #53d22c;
      }
      
      /* Loading state */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }
    </style>
</head>
<body style='font-family: Manrope, "Noto Sans", sans-serif;' class="overflow-hidden">
    <div class="relative flex size-full min-h-screen flex-col bg-[#162013] dark justify-between group/design-root">
      <div> <!-- Main content wrapper -->
        
        <div class="@container"> 
          <div class="@[480px]:px-2 @[480px]:pt-2 @[480px]:pb-1"> 
            <div
              class="w-full bg-no-repeat bg-cover flex flex-col justify-end overflow-hidden bg-[#162013] @[480px]:rounded-lg min-h-[140px]" 
              style="background-image: url('KamboFrog.png'); background-position: center -120px;"
            ></div>
          </div>
        </div>

        <div class="text-center px-2 pt-4 pb-0 mb-4"> 
          <p class="text-white text-xl font-bold leading-tight" id="sessionTypeNamePlaceholder">Loading...</p>
          <p class="text-gray-400 text-xs" id="sessionTypeDurationPlaceholder">(Duration)</p>
        </div>

        <div class="flex flex-wrap items-center justify-center gap-1 px-4 py-0"> 
          <div class="flex min-w-72 flex-1 flex-col gap-0 pb-1"> 
            <div class="flex items-center p-0 justify-between">
              <button id="prevMonthButton" aria-label="Previous Month">
                <div class="text-white flex size-8 items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256" stroke="currentColor" stroke-width="8">
                    <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                  </svg>
                </div>
              </button>
              <p id="currentMonthYear" class="text-white text-xl font-bold leading-tight flex-1 text-center">Loading...</p> 
              <button id="nextMonthButton" aria-label="Next Month">
                <div class="text-white flex size-8 items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256" stroke="currentColor" stroke-width="8">
                    <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
                  </svg>
                </div>
              </button>
            </div>
            <!-- Dynamic Calendar Grid -->
            <div id="calendarGrid" class="grid grid-cols-7">
              <!-- Day headers -->
              <p class="text-white text-sm font-extrabold leading-normal flex h-8 w-full items-center justify-center">S</p>
              <p class="text-white text-sm font-extrabold leading-normal flex h-8 w-full items-center justify-center">M</p>
              <p class="text-white text-sm font-extrabold leading-normal flex h-8 w-full items-center justify-center">T</p>
              <p class="text-white text-sm font-extrabold leading-normal flex h-8 w-full items-center justify-center">W</p>
              <p class="text-white text-sm font-extrabold leading-normal flex h-8 w-full items-center justify-center">T</p>
              <p class="text-white text-sm font-extrabold leading-normal flex h-8 w-full items-center justify-center">F</p>
              <p class="text-white text-sm font-extrabold leading-normal flex h-8 w-full items-center justify-center">S</p>
              <!-- Calendar days will be dynamically inserted here -->
            </div>
          </div>
        </div>

        <section class="booking-summary px-2 py-1 mt-1 text-center h-12 flex items-center justify-center" style="display: none;">
            <p id="selectedBookingInfo" class="text-white text-lg font-bold">Select a date and time</p>
        </section>

        <!-- Message when no date selected -->
        <div id="selectDateMessage" class="text-center py-4 px-4">
            <p class="text-[#5a844d] text-lg font-bold">Select an available day</p>
        </div>

        <!-- Time Scroller -->
        <div id="timePickerContainer" class="relative h-36 overflow-hidden time-scroll-container w-full px-2 mt-0 mb-2" style="display: none;"> 
          
          <div id="selectorBar" class="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-12 bg-[#2e4328] rounded-md pointer-events-none z-0 transition-colors duration-300"></div> 
          
          <div id="timeSlotList" class="absolute inset-0 overflow-y-auto snap-y snap-mandatory text-center py-[56px] z-10"> 
            <div class="snap-center h-12 flex items-center justify-center text-lg font-bold text-[#5a844d] time-slot-item">Select a date first</div>
          </div>
        </div>
        <!-- End Time Scroller -->

      </div>

      <div class="mt-2">
        <div class="flex justify-stretch">
          <div class="flex flex-1 gap-2 flex-wrap px-2 pt-0 pb-6 justify-between"> 
            <button id="submitBookingButton" disabled class="flex flex-1 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-gray-600 text-white text-base font-bold leading-normal tracking-[0.015em] disabled:cursor-not-allowed">
              <span>Book</span>
            </button>
            <button id="cancelBookingButton" class="flex flex-1 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-gray-600 text-white text-base font-bold leading-normal tracking-[0.015em]">
              <span class="truncate">Cancel Booking</span>
            </button>
          </div>
        </div>
        <div class="h-8 bg-[#162013]"></div> 
      </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Disable the swipe-down gesture that collapses or closes the Mini App
        if (tg.isVersionAtLeast('7.7')) {
          tg.disableVerticalSwipes();
          console.log("Vertical swipes disabled for Telegram WebApp.");
        }
    </script>
    
    <!-- Calendar API Module -->
    <script src="calendar-api.js"></script>
    <!-- Calendar App JavaScript -->
    <script src="calendar-app.js"></script>
</body>
</html>