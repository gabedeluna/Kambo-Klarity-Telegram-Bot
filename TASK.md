# TASK.md â€“ Active Sprint Checklist

> **How to use:** Windsurf AI (or any dev) should tick a `- [ ]` when done, add notes beneath the task, and fill the Discovery & Insights sections as they learn.

## ðŸ“… Current Phase 6 â€“ Admin Essentials & Calendar Booking Activation

| ID            | Task                                                                                                       | Why / Acceptance Criteria                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :------------ | :--------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [X]**PH6â€‘01** | **Implement Admin Designation (`bin/set_admin.js`)**                                                       | (No Change) Provide a script/mechanism to assign the 'admin' role to a specific user via Telegram ID. *Pass*: Script created, accepts TG ID, updates user role to 'admin' in DB, uses core Prisma/Logger. Calls `setRoleSpecificCommands`.                                                                                                                                                                                       |
| [X]**PH6â€‘02** | **Implement Role-Based Command Router & Refine Help Command**                                                | (No Change) Implement `commandHandler.js` for role-based command routing. Update `commandRegistry.js`. Distinct `/help` for client/admin. *Pass*: Manual test shows distinct `/help` & role-based command access.                                                                                                                                                                                                                       |
| [X]**PH6â€‘03** | **Consolidate Command Handling & Deprecate `commandRouter.js`**                                              | (As previously discussed) Ensure `updateRouter.js` calls `commandHandler.handleCommand`. Verify robust role-based logic in `commandHandler.js`. Remove `src/middleware/commandRouter.js`. *Pass*: `commandRouter.js` removed. Command routing is streamlined. Manual tests pass.                                                                                                                                                    |
| [X]**PH6â€‘04** | **DB: Define `SessionType` Prisma Model & Migrate**                                                          | (No Change) Define `SessionType` model in `prisma/schema.prisma` (id, label, durationMinutes, description, price, active). Run `npx prisma migrate dev`. *Pass*: Migration successful.                                                                                                                                                                                                                                           |
| [X]**PH6â€‘05** | **DB: Populate Initial Session Types**                                                                       | (No Change) Populate `SessionType` table with initial data from `src/config/sessionTypes.json`. *Pass*: `SessionType` table contains initial data.                                                                                                                                                                                                                                                                                         |
| [X]**PH6â€‘06** | **Core: Refactor `core/sessionTypes.js` for DB Access & Add CRUD Stubs**                                       | (No Change) Update `getAll()` & `getById()` for DB. Add stub CRUD functions. *Pass*: `getAll()`, `getById()` work with DB. Unit tests pass.                                                                                                                                                                                                                                                                                               |
|               |                                                                                                            | **--- Booking Flow Overhaul Starts Here ---**                                                                                                                                                                                                                                                                                                                                                                                                    |
| [X]**PH6â€‘07** | **Tool: Enhance `telegramNotifier.sendSessionTypeSelector` (DB, 3x3 Rule)**                                  | Update tool in `src/tools/telegramNotifier.js`: Use `core/sessionTypes.getAll()` & `stateManager.getUserPastSessions`. If user has no past *completed* sessions, filter out "3x3 Kambo" (or specific ID) before creating inline keyboard. *Pass*: Selector shows correct types based on user history. Unit tests pass.                                                                                                            |
| [X]**PH6â€‘08** | **Command: Update `/book` Client Command**                                                                   | `src/commands/client/book.js` calls `telegramNotifier.sendSessionTypeSelector` (PH6-07). *Pass*: `/book` triggers role-aware session type selector.                                                                                                                                                                                                                                                                                       |
| [X]**PH6â€‘09** | **Handler: Update `callbackQueryHandler.js` for Session Selection**                                          | On `book_session:<id>` callback: Store `selectedSessionTypeId` and `telegramId` in `ctx.state` or user DB state. Use `stateManager.updateUserState` to store `edit_msg_id` of the selector message. Edit selector message to "You selected {Type}. [Book Now]" button. Button links to `/calendar-app?telegramId=X&sessionTypeId=Y`. *Pass*: Message edited, "Book Now" button links correctly.                                             |
| [X]**PH6â€‘10** | **Live GCal Read: Implement `googleCalendar.findFreeSlots` (Live)**                                          | Refactor `src/tools/googleCalendar.js` `findFreeSlots` to use `googleapis` to fetch real free/busy info. Handle OAuth2 (service account recommended). Respect practitioner's working hours & 60-day advance limit. *Pass*: Tool returns actual available slots from GCal. Requires Google Cloud setup. MCP consultation on OAuth.                                                                                             |
| [X]**PH6â€‘11** | **API: Create `GET /api/calendar/availability` Endpoint**                                                    | New Express route. Input: `startDate`, `endDate`, `sessionDurationMinutes`. Calls live `googleCalendar.findFreeSlots` (PH6-10). Returns JSON of available slots. *Pass*: Endpoint returns valid slot data. Supertest tests pass.                                                                                                                                                                                              |
| [X]**PH6â€‘12** | **API: Create `GET /api/session-types/:id` Endpoint**                                                    | New Express route. Input: `sessionTypeId`. Calls `coreSessionTypes.getById(id)`. Returns JSON of session type details. *Pass*: Endpoint returns valid session type data. Supertest tests pass. (Originally Calendar Mini-App Shell, reassigned to API endpoint)                                                                                                                                                                                              |
| [X]**PH6â€‘13**  | **Calendar Mini-App: Static Frontend Shell & Basic JS (`calendar-app.html`)** | Create `public/calendar-app.html` & `public/calendar-app.css`. <br>Layout: Header (Back arrow, "Kambo Klarity"), Frog image, Month/Year display & Nav arrows, Calendar day grid, Scrollable time slot area (3 visible, middle selected), "Booking for: [Date] at [Time] [TZ]" (initially hidden/placeholder), "Submit" button (left, initially "Select a Time"), "Cancel Booking" button (right). <br>Style: Dark theme, match visual mockup. <br>Basic JS: Parse `telegramId` & `initialSessionTypeId` from URL. "Cancel Booking" button calls `tg.close()`. <br>*Pass*: HTML/CSS matches mockup structure. JS loads params. Cancel works. |
| [ ]**PH6â€‘14**  | **Calendar Mini-App: Fetch Initial Session Details & Display Availability** | `calendar-app.html` JS: <br>1. On load, use `initialSessionTypeId` to call `GET /api/session-types/:id` (PH6-12) to get `label` & `durationMinutes`. <br>2. Call `GET /api/calendar/availability` (PH6-11) using this `durationMinutes` for current month. <br>3. Render returned UTC slots in the scrollable time slot UI (middle one highlighted, convert to user's local time for display). <br>4. Implement Prev/Next month buttons to re-fetch availability. <br>5. When a slot is clicked: update "Booking for..." text, enable "Submit" button (text "Book for {Time}"). <br>*Pass*: Calendar displays slots for initial session type. Month nav works. Slot selection updates UI. |
| [ ]**PH6â€‘15**  | **Calendar Mini-App: Transition to Waiver Form on "Submit"**              | `calendar-app.html` JS: <br>When "Submit" (now "Book for {Time}") button is clicked: <br>1. Gather `telegramId`, `initialSessionTypeId`, selected `appointmentDateTimeISO` (UTC). <br>2. **Navigate within the WebApp to `waiver-form.html`**, passing these three parameters in the URL (e.g., `waiver-form.html?tgId=X&sTypeId=Y&apptTime=Z`). <br>*Pass*: Clicking "Submit" in calendar correctly loads `waiver-form.html` with necessary parameters in its URL. No backend API call from calendar app to book yet. |
| [ ]**PH6â€‘16**  | **Waiver Form: Adapt to Receive & Use Calendar Data (`waiver-form.html`)** | Modify `public/waiver-form.html` JS: <br>1. On load, parse `telegramId`, `sessionTypeId`, `appointmentDateTimeISO` from its *own* URL (passed by calendar app). <br>2. Store these for submission. <br>3. Pre-fill user data as before using `GET /api/user-data?telegramId=X`. <br>4. Display selected `sessionType` label (fetch via `GET /api/session-types/:id` if label not passed) and formatted `appointmentDateTimeISO`. *Pass*: Waiver form loads, displays correct session context from calendar, ready for submission. |
| [ ]**PH6â€‘17**  | **API & Waiver Submit: Create Session, Edit Bot Msg, Redirect to Invite Page** | Modify `apiHandler.submitWaiverApi` (`POST /api/submit-waiver`): <br>1. Expects all waiver fields + `telegramId`, `sessionTypeId`, `appointmentDateTimeISO`. <br>2. **Creates new `Session` record** (status `CONFIRMED`, store `appointment_datetime` as UTC, `liability_form_data`). <br>3. Fetches `user.edit_msg_id` (ID of original "Choose Session Type" WebApp button message). <br>4. Fetches `SessionType.label` for `sessionTypeId`. <br>5. Edits that Telegram message (using `chatId`, `editMsgId`): Frog pic, text "Your {SessionTypeLabel} is booked for {Formatted Date & Time}!", and (if invites allowed) a new WebApp button "[Invite Friends]" linking to `invite-friends.html?sessionId=NEW_SESSION_ID&telegramId=X`. <br>6. Stores new `edit_msg_id` (of this frog pic message) if "Invite Friends" button was added. Else, clear `edit_msg_id`. <br>7. Notify admin of confirmed booking & waiver. <br>8. Responds to `waiver-form.html` with JSON `{ success: true, redirectTo: '/invite-friends.html?sessionId=NEW_SESSION_ID&telegramId=X' }`. <br>*Pass*: `Session` created. Bot msg updated. Admin notified. API responds with redirect URL. |
| [ ]**PH6â€‘18**  | **Waiver Form: Handle Redirect to Invite Page After Submission**          | `waiver-form.html` JS: On successful response from `POST /api/submit-waiver` (PH6-17), if `redirectTo` URL is present, navigate the WebApp view to this URL (e.g., `window.location.href = data.redirectTo;`). *Pass*: After waiver submit, user is taken to `invite-friends.html`. |
| [ ]**PH6â€‘19**  | **DB: Update `AvailabilityRule` (add `max_group_invites`); Create `SessionInvite` Table** | 1. `AvailabilityRule`: Add `max_group_invites Int @default(3) @NotDbNull`. Update seed. <br>2. `SessionInvite`: `id PK`, `parent_session_id FK Session`, `invite_token String @unique`, `status String @default("pending")` ('pending', 'accepted_by_friend', 'declined_by_friend', 'waiver_completed_by_friend'), `friend_telegram_id BigInt?`, `friend_name_on_waiver String?`, `created_at`, `updated_at`. <br>3. Migrations. *Pass*: DB schema updated. |
| [ ]**PH6â€‘20**  | **API: `GET /api/sessions/:sessionId/invite-context` for Invite Page**      | New endpoint for `invite-friends.html`. <br>Input: `sessionId`. <br>Action: Fetch `Session` (verify it belongs to current user via `telegramId` also passed in query/header for auth). Fetch `AvailabilityRule.max_group_invites`. Fetch existing `SessionInvite`s for `parent_session_id`. <br>Output: `{ success, data: { maxInvites, sessionDetails: {typeLabel, apptTimeFormatted}, existingInvites: [{token, status, friendName}] } }`. *Pass*: API returns data for invite page. |
| [ ]**PH6â€‘21**  | **Invite Page: Static Shell & Initial Data Load (`invite-friends.html`)**   | Create `public/invite-friends.html` (styled like others). <br>Layout: "Booking Confirmed!" / "Invite Friends!" text. Instructions. Area for dynamic invite links (rounded rectangles). Initial "+" button if `existingInvites.length < maxInvites`. "Finish" button. <br>JS: Parse `sessionId`, `telegramId` from URL. Call `GET /api/sessions/:sessionId/invite-context` (PH6-20). Display info. Render `existingInvites` (greyed out, "Invite Sent to {Name}"). Manage "+" button visibility. *Pass*: Page loads, displays initial state. |
| [ ]**PH6â€‘22**  | **API: `POST /api/sessions/:sessionId/generate-invite-token`**            | Called by "+" on `invite-friends.html`. <br>Input: `sessionId`. <br>Action: Check `SessionInvite` count against `max_group_invites`. If not reached, create new `SessionInvite` with unique `invite_token`. <br>Output: `{ success, newInvite: { token, status: "pending" } }` or error. *Pass*: API generates new token if allowed. |
| [ ]**PH6â€‘23**  | **Invite Page: Dynamic Invite Link UI ("+" Button & Stepper Logic)**        | `invite-friends.html` JS: Stepper UI (`+` / `-`, count, max). "+" calls `POST .../generate-invite-token` (PH6-22). On success, add new "Invite Link" UI section (rounded rectangle) with placeholder text, its unique token (hidden), and "Share on TG", "Share Other", "Copy Link" buttons. Decrementing stepper removes last *unused* placeholder. Used links (marked after sharing) cannot be removed by stepper. *Pass*: UI dynamically adds/removes invite sections up to max. Stepper reflects used links. |
| [ ]**PH6â€‘24**  | **Invite Page: "Share on Telegram" (`switchInlineQuery`) & Bot Handler**  | 1. `invite-friends.html` JS: "Share on Telegram" button calls `tg.switchInlineQuery('@YOUR_BOT_NAME', 'kbinvite_{invite_token}')`. Mark link UI as "shared", move to top. <br>2. Bot: `bot.on('inline_query', ...)` if query `kbinvite_TOKEN`: parse token, fetch `SessionInvite` & parent `Session`. Respond `InlineQueryResultArticle` ("{Inviter} invited you to {SessionType} on {Date}", `input_message_content` has "Join?" text & `[Accept invite_TOKEN]`, `[Decline invite_TOKEN]` inline buttons). *Pass*: Share button works. Bot inline handler responds. Link UI updates. |
| [ ]**PH6â€‘25**  | **Invite Page: "Share via Other" (`navigator.share`) & "Copy Link" Buttons** | `invite-friends.html` JS: <br>1. "Share via Other": Tries `navigator.share({url: 'FORM_URL/join-session.html?token=X'})`. <br>2. "Copy Link": Copies `FORM_URL/join-session.html?token=X`. <br>3. UI: Feedback ("Copied!", "Shared!"). Mark link UI as "shared", move to top. *Pass*: Sharing/copying works. |
| [ ]**PH6â€‘26**  | **Invite Page: "Finish" Button Logic**                                    | `invite-friends.html` JS: "Finish" button calls `window.Telegram.WebApp.close()`. *(The bot message was already updated in PH6-17 by `/api/submit-waiver` to show the frog pic and initial "Invite Friends" button. The state of that button on the bot message reflecting remaining invites is a future enhancement if needed, for now it's static)*. *Pass*: Finish button closes WebApp. |
| [ ]**PH6â€‘27**  | **Friend Flow: `join-session.html` Page (Static Shell & Data Load)**      | Create `public/join-session.html`. JS: Parse `token`. Call `GET /api/session-invites/:token/details` (from PH6-IF8 concept, new endpoint needed if not covered by PH6-20 for this specific view). Display "Invited by {Inviter}..." & "[Accept Invite]" / "[Decline Invite]" buttons. *Pass*: Page loads invite details. |
| [ ]**PH6â€‘28**  | **Friend Flow: API `POST /api/session-invites/:token/respond` & Bot Deep Links** | New API. Input: `invite_token`, `response` ('accepted'/'declined'). Action: Update `SessionInvite.status`. <br>  - If 'accepted': Check if friend `telegram_id` for this invite is already known (e.g., previous interaction with this token). If not (first time accepting this specific token), respond `{needsRegistration: true, deepLink: 'https://t.me/YOUR_BOT_NAME?start=reg_invite_TOKEN'}`. Else, respond `{needsWaiver: true, deepLink: 'https://t.me/YOUR_BOT_NAME?start=waiver_invite_TOKEN'}`. <br>  - If 'declined': Notify original inviter. Respond `{success:true}`. <br>*Pass*: API updates status, returns correct deep link. |
| [ ]**PH6â€‘29**  | **Friend Flow: `join-session.html` JS Buttons & Redirect**                | JS for buttons: "Accept" POSTs to `.../:token/respond` with `response:'accepted'`. On API response, `tg.openTelegramLink(response.deepLink)` then `tg.close()`. "Decline" POSTs. On success, show "Response sent", then `tg.close()`. *Pass*: Buttons redirect to bot DM or close. |
| [ ]**PH6â€‘30**  | **Bot: Handle `/start` Deep Links from Friend Invites**                     | Modify `/start` handler: If `ctx.startPayload` is `reg_invite_TOKEN`: Parse token. Validate. Associate `ctx.from.id` with `SessionInvite.friend_telegram_id`. Send registration link. Set state (e.g., `AWAITING_FRIEND_REG_FOR_INVITE_TOKEN`). <br>If `waiver_invite_TOKEN`: Validate. Associate user. Send waiver link (pre-fill with `sessionId` from invite's `parent_session_id` and `inviteToken`). Set state. *Pass*: Deep links work. |
| [ ]**PH6â€‘31**  | **Friend Flow: Waiver Submission & Inviter/Admin Notification**             | Modify `POST /api/submit-waiver`: <br>If `inviteToken` is in POST body: Update `SessionInvite` (status `waiver_completed_by_friend`, store `friend_name_on_waiver` if available from waiver). Notify original inviter: "Congrats! {Friend's Name} completed waiver!". Notify admin. Respond success to waiver form (it can close). <br>Else (primary user): proceed as original PH6-17. *Pass*: Friend's waiver updates invite. Notifications. |
| [ ]**PH6â€‘32**  | **Styling: Ensure All WebApp Pages are Cohesive**                           | Review/update CSS for `registration-form.html`, `waiver-form.html`, `calendar-app.html`, `invite-friends.html`, `join-session.html` for consistent dark theme & style. *Pass*: Pages look unified. |
| [ ]**PH6â€‘33**  | **Documentation & Review for Phase 6 (Full Flow)**                        | JSDoc. Update `PLANNING.MD` (Phase 6, Section 11) & `architecture.md`. Update/Create Manual Test Plans for entire booking & invite flow. *Pass*: Docs current. Test plans cover new flows. |
| [ ]**PH6â€‘34**  | **Final Review & TASK.MD Updates for Phase 6**                            | Tick all Phase 6 tasks. Fill Discoveries/Insights. *Pass*: All Phase 6 complete. `TASK.MD` up to date. |

## ðŸ§ª Testing Overhaul

| ID            | Task                                       | Why / Acceptance Criteria                                                                                                                                                              |
| :------------ | :----------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [ ]**PH_TEST-01** | **Integrate Jest Testing Framework** | Replace Mocha with Jest. Configure Jest for the project. Define unit and integration testing strategy. Install dependencies, update package.json scripts. Create initial test structure. |

| [X]**PH_TEST-01.7** | **Create Initial Unit Test for `src/tools/telegramNotifier.js`** | 2025-05-20: Create `tests/tools/telegramNotifier.test.js` with initial mock structure and TODOs for `telegramNotifier.js` functions. Aligns with JEST_INTEGRATION_PLAN.md Phase 2, Step 7. |
---
| [X]**PH_TEST-02** | **Run tests for env.test.js** | 2025-05-20: Execute npm test to verify changes in tests/core/env.test.js. Report outcome. |


### Discovered During Work (Phase 6)

- **PH6-D1 (PH6-05):** Initial implementation of `sessionTypes.js` CRUD operations targeted basic create, read (all/by ID), update, and a soft delete (`deleteTypeOrDeactivate`).
- **PH6-D2 (PH6-05):** Created `bin/test_sessionTypes_module.js` to perform manual end-to-end testing of these CRUD functions against the live database.
- **PH6-D3 (PH6-05):** Identified a `TypeError` during testing related to logger instantiation in `src/core/prisma.js`. Corrected by ensuring the main app logger was imported and a child logger created for Prisma.
- **PH6-D4 (PH6-05):** Refined Prisma client shutdown handlers in `src/core/prisma.js` for more robust error logging and graceful disconnection.
- **PH6-D5 (PH6-05):** Based on testing and requirements clarification, evolved `sessionTypes.js`:
    - Renamed `deleteTypeOrDeactivate` to `deactivateType` for clarity (still performs soft delete by setting `active: false`).
    - Added `reactivateType(id)` to set `active: true`.
    - Added `deleteType(id)` for actual hard deletion of records from the database.
- **PH6-D6 (PH6-05):** Updated `bin/test_sessionTypes_module.js` to cover the full lifecycle: create -> read -> update -> read -> deactivate -> read (inactive) -> reactivate -> read (active) -> delete (hard) -> read (verify null).
- **(PH6-10):** Implemented full `findFreeSlots` logic in `googleCalendar.js`. Discovered complexities in handling timezones (practitioner vs. UTC), date math with `date-fns` and `date-fns-tz` (especially ensuring correct day boundaries and earliest booking times in practitioner's timezone), and nuances of Google Calendar API for fetching events within specific time ranges. The `slot_increment_minutes` from `AvailabilityRule` was integrated. Extensive debugging logs (`[SlotGenDebug]`) were added for traceability. The `max_bookings_per_day` rule was refined to only check existing GCal bookings, not limit the display of *available* slots.
- **(PH6-11):** Ensured `GoogleCalendarTool` dependency injection was correctly configured in [`src/app.js`](src/app.js) and [`src/handlers/apiHandler.js`](src/handlers/apiHandler.js). Initial plan included integration tests, but these were skipped based on user feedback during the process.
- **(PH6-12):** Implemented the `GET /api/session-types/:id` endpoint. To maintain code organization and adhere to file length limits, the handler logic was placed in a new file: [`src/handlers/api/sessionTypesApiHandler.js`](src/handlers/api/sessionTypesApiHandler.js:1). The main API router ([`src/routes/api.js`](src/routes/api.js:1)) was updated to use this new handler. The process involved standard linting and formatting, and a minor fix for an unused variable (`next` changed to `_next`) in the handler.

### Summary (Phase 6)

*Summary of changes and decisions.*

- **(PH6â€‘02):** Implement `commandHandler.js` (or `commandRouter.js`) to handle role-based command routing. Update `commandRegistry.js`. Distinct `/help` for client/admin. *Pass*: Tests pass. Manual test shows distinct `/help` & role-based command access (admin can use admin commands, client cannot).                                                                                                                
- **(PH6-04, PH6-05):** Transitioned `SessionType` management from a static JSON file to direct Prisma database integration. This was a key step to enable dynamic management of session types by administrators and to lay the groundwork for more complex booking and scheduling features. The direct DB approach ensures data consistency and avoids manual file updates.
- **(PH6-06):** Implemented a comprehensive CRUD (Create, Read, Update, Delete) cycle for `SessionType` entities. This included evolving the 'delete' functionality to distinguish between soft-deletion (deactivation, setting `active: false`) and hard-deletion (permanent removal from DB). Also added a `reactivateType` function. This provides flexibility for data retention policies and administrative control, while ensuring test data can be cleanly removed.
- **(PH6-05):** Utilized a temporary, command-line test script (`bin/test_sessionTypes_module.js`) for rapid, iterative manual testing of the `sessionTypes.js` module against a live database. This allowed for quick verification of each CRUD operation and its database impact before integrating with more complex parts of the system like agents or bot commands.
- **(PH6-07):** Database Changes:
Removed conversation_history and current_action fields from the users table
Added can_book_3x3 field to the users table with a default value of false
- **(PH6-07):** Webhook Management:
Created a new bin/set_webhook.js utility script for manual webhook setup
Updated app.js to remove automatic webhook setting and polling
Added a new npm script webhook:set to run the webhook utility
Fixed a case mismatch in the ngrokUrl reference in server.js
- **(PH6-07):** Session Type Filtering:
Updated stateManager.getUserProfileData to include the can_book_3x3 field
Modified telegramNotifier.sendSessionTypeSelector to filter session types based on the user's permission
Added logic to filter out the "3hr-kambo" session type for users without permission
- **(PH6-10):** Successfully implemented the full logic for `findFreeSlots` in `src/tools/googleCalendar.js`, integrating live Google Calendar API calls. This involved: fetching practitioner availability rules and timezone from the database; correctly calculating earliest booking time and maximum booking date based on these rules and current time; iterating through days and rule blocks in the practitioner's timezone; generating potential slots based on `slot_increment_minutes`; checking against existing Kambo session and personal calendar events (with `buffer_time_minutes`); and correctly handling the `max_bookings_per_day` rule by only considering existing bookings. The process highlighted the importance of meticulous timezone conversions (UTC to/from practitioner's timezone) and careful date arithmetic using `date-fns` and `date-fns-tz`. Extensive `[SlotGenDebug]` logging was added to trace slot generation and conflict checks, proving invaluable for debugging.
- **(PH6-11):** Implemented the `GET /api/calendar/availability` endpoint on the `feat/PH6-11-Calendar-Api` branch. This provides functionality to retrieve available calendar slots. Key files modified: [`src/app.js`](src/app.js), [`src/handlers/apiHandler.js`](src/handlers/apiHandler.js), [`src/routes/api.js`](src/routes/api.js).
- **(PH6-12):** Successfully created the `GET /api/session-types/:id` endpoint on the `feat/PH6-12-session-type-api` branch (commit `096442f`). This endpoint allows the frontend calendar application to retrieve detailed information about a specific session type (e.g., label, durationMinutes) using its ID. The implementation included creating a new handler file ([`src/handlers/api/sessionTypesApiHandler.js`](src/handlers/api/sessionTypesApiHandler.js:1)) and updating the API router ([`src/routes/api.js`](src/routes/api.js:1)).
- **(PH6-13):** Created the complete calendar mini-app frontend shell (`public/calendar-app.html`) with dark theme styling using Tailwind CSS. Key features implemented: Telegram WebApp integration with parameter parsing (`telegramId`, `sessionTypeId`), frog image header with proper background positioning, month/year navigation controls, 7-day calendar grid layout, scrollable time slot picker with gradient highlighting effects (3 visible slots with center selection), booking summary section, and dual action buttons (Submit/Cancel). Added sophisticated scroll-based highlighting system for time slots with CSS masking for fade effects. Integrated Telegram WebApp SDK with proper initialization, back button handling, and close functionality. The layout is fully responsive and matches the dark theme mockup requirements.
```                                                  |
| [ ]**PH_TEST-01** | **Integrate Jest Testing Framework** | 2025-05-20: Replace Mocha with Jest. Configure Jest for the project. Define unit and integration testing strategy. Install dependencies, update package.json scripts. Create initial test structure. |
